# ----- GLOBAL/HTTP-LEVEL HARDENING & PERFORMANCE -----
http {
    # Hide Nginx version
    server_tokens off;

    # Strong ETag support (cache validation)
    etag on;

    # Gzip compression
    gzip on;
    gzip_comp_level 5;
    gzip_min_length 256;
    gzip_vary on;
    gzip_proxied any;
    gzip_types
        text/plain
        text/css
        text/xml
        application/json
        application/javascript
        application/x-javascript
        application/xml
        application/rss+xml
        image/svg+xml;

    # Rate limiting (5 requests/sec per IP; ~16k IPs tracked)
    limit_req_zone $binary_remote_addr zone=api_ratelimit:10m rate=5r/s;

    # (Keep the rest of your existing http{} content, includes, logs, etc.)
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # Include all enabled sites
    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;
}
